<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.7.6.1"/>
<title>Imperial Analysis: docs/BuildSystem.md Source File</title>

<link href="$relpath^tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="$relpath^jquery.js"></script>
<script type="text/javascript" src="$relpath^dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>

<link href="$relpath^doxygen.css" rel="stylesheet" type="text/css" />
$extrastylesheet
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 70px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Imperial Analysis
   
   </div>
   
  </td>
  
  
  
   
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
   
  
 </tr>
 </tbody>
</table>
</div>

<!-- end header part -->
<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_build_system_8md.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">docs/BuildSystem.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_build_system_8md.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 Analysis Build System {#build-system}
<a name="l00002"></a>00002 =====================================
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 [TOC]
<a name="l00005"></a>00005 
<a name="l00006"></a><a class="code" href="_build_system_8md.html#a33d5b668d605304fdc87df4cb7eaff97">00006</a> This page documents the build system <span class="keywordflow">for</span> compiling the offline analysis code as well as the folder structure <span class="keyword">this</span> system expects. Much like the CMSSW <a class="code" href="_main_8md.html#a4656b1b3cd771a98aff167eb21165897">framework</a>, code under the **Analysis** folder is arranged into <a class="code" href="_build_system_8md.html#a97910060fd2622a905e6c1c50f0019c2">packages</a>, with each <span class="keyword">package </span>grouping together a related set of classes, programs and scripts. For example, the **Core** folder contains the basic classes for building an analysis and plotting the results, whereas the **HiggsTauTau** folder contains the code specific to the Higgs to taus analysis.
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 Code in the **Analysis** folder can be thought of as separate from the **ICHiggsTauTau** CMSSW package, and indeed is ignored by the `scram` tool. Instead we use  `make` to resolve dependencies between the different analysis packages and to compile the code. In the past, a separate makefile was provided in each package sub-directory which would have hard-coded calls to the makefiles of other packages which are dependencies. This so-called recursive make system had a number of issues, in particular the need to maintain several makefiles containing mostly repeated content and the recompilation of large amounts of code triggered by any change in other packages. See [this](http:<span class="comment">//aegis.sourceforge.net/auug97.pdf) page for a detailed discussion of the problems with recursive make. Instead a single makefile is used and which has a global awareness of code in all packages and can efficiently resolve the dependencies whilst still allowing for single packages to to be compiled. This was derived from the example system [here](https://github.com/aostruszka/nonrec-make).</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 Folder Structure {#build-system-folders}
<a name="l00011"></a>00011 ========================================
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 Each package must contain, at the minimum, the following files and folders:
<a name="l00014"></a>00014 
<a name="l00015"></a>00015     makefile
<a name="l00016"></a>00016     Rules.mk
<a name="l00017"></a>00017     interface/
<a name="l00018"></a>00018     src/
<a name="l00019"></a>00019     obj/
<a name="l00020"></a>00020     lib/
<a name="l00021"></a>00021     test/
<a name="l00022"></a>00022     bin/
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 The `makefile` should just be a symbolic link the file in `Analysis/mk/makefile`. The file `Rules.mk` is a makefile fragment and defines just a few variables to guide the build system in this package.  If you are setting up a new package you can just do:
<a name="l00025"></a>00025 
<a name="l00026"></a>00026     mkdir [package]
<a name="l00027"></a>00027     cd [package]
<a name="l00028"></a>00028     ln -s ../mk/makefile ./
<a name="l00029"></a>00029     cp ../Rules.mk ./  # copy the top-level Rules.mk to use as a template
<a name="l00030"></a>00030     mkdir interface src obj lib test bin
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 Class definition and implementation files should be placed in the `interface` and `src` directories respectively. Each file in the `src` should have the extension .cc* and will be compiled to a corresponding object file in the `obj` directory.  All object files are then combined into a shared library which will reside in the `lib` directory, and will have the name of the containing folder prefixed with libIC, e.g. `libICCore.so` is the library name in the **Core** package. The source code for executable programs goes in the `test` directories with the extension .cpp. Each of these files will be compiled to an executable in the `bin` directory and linked against the shared library in the process.
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 The Rules.mk file  {#build-system-rules-mk}
<a name="l00035"></a>00035 =================
<a name="l00036"></a>00036 A file named `Rules.mk` must be placed in each directory to tell the build system that it contains code to be compiled. This file should define three variables, some or all of which may be empty. This is an example from the **HiggsTauTau** package:
<a name="l00037"></a>00037 
<a name="l00038"></a>00038     SUBDIRS   :=
<a name="l00039"></a>00039     LIB_DEPS  := Core Utilities Modules
<a name="l00040"></a>00040     LIB_EXTRA := -lCondFormatsJetMETObjects
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 SUBDIRS is a space separated list of the any sub-directories that also define a package, it tells make to enter each directory in turn, look for a `Rules.mk` file and apply the compile rules outlined above. In this case it&#39;s empty as **HiggsTauTau** does not contain any additional packages. LIB_DEPS lists the packages that this one depends on, i.e. which other shared libraries need to be built first and then linked against the shared library and executables defined here. In this example the **Core**, **Utilities** and **Modules** shared libraries are marked as dependencies. LIB_EXTRA is a string that will added as an argument when the `g++` compiler is invoked and will typically be used to link code against additional external libraries (a number of external libraries are linked by default, see below).
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 When `make` is invoked it will first look for a `Rules.top` file, which has the same structure as a `Rules.mk` file and is used to identify the top directory where sub-directory scanning should start. It will first look in the current directory then repeatedly change to the enclosing directory until this file is found, which in this case in the **Analysis** folder. The `Rules.top` file here only needs to define the sub-directories to be scanned, and you should add the name of any new packages to this list. Each named directory is then scanned for compile targets by looking for files with the appropriate extensions in the `src` and `test` directories.
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 Invoking make {#build-system-invoke}
<a name="l00047"></a>00047 =============
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 The makefile defines a number of special targets that can be built by running: `make [target]`
<a name="l00050"></a>00050 
<a name="l00051"></a>00051  * `make dir` or just `make`: Only compile the code in the current directory, including the minimum set of dependencies in other packages if necessary.
<a name="l00052"></a>00052  * `make tree`: Compile the code in the current directory, and recursively into all sub-directories starting from this one (as defined in each `Rules.mk` file)
<a name="l00053"></a>00053  * `make all`: Compile every package recursively starting from the top directory
<a name="l00054"></a>00054  * `make clean`: Removes every file in the `bin`, `obj` and `lib` directories in the current package
<a name="l00055"></a>00055  * `make clean_tree`: Also cleans packages in sub-directories
<a name="l00056"></a>00056  * `make clean_all`: Clean every package recursively starting from the top directory
<a name="l00057"></a>00057  * `make bin/[program]` Shortcut target for each executable in the current directory. This provides a quick way to update a single program.
<a name="l00058"></a>00058 
<a name="l00059"></a>00059  On machines with multiple processor cores add the `-j[n]` option to compile with *n* threads. By default the makefile will just print a summary of each operation to the screen. To print the full command for each step add the option `V=1`. The option `DEBUG=1` can also be added which will cause make to print a list of the targets it finds as it scans directories.
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 External libraries {#build-system-external}
<a name="l00063"></a>00063 ==================
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 A number of header file search paths are defined in the makefile, and several external libraries will be linked by default:
<a name="l00066"></a>00066 
<a name="l00067"></a>00067  * ROOT: The version of ROOT that ships with the CMSSW version you are using will be searched for header files and the common libraries linked. ROOT header files can be included directly in Analysis code, e.g. `#include &quot;TFile.h&quot;`
<a name="l00068"></a>00068  * ROOFIT: As for ROOT, ROOFIT headers can be included directly, e.g. `#include &quot;RooRealVar.h&quot;`
<a name="l00069"></a>00069  * boost: The C++ [boost](http:<span class="comment">//www.boost.org) libraries may also be used. These provide a large range of useful extensions to the core C++ libraries. Most boost libraries are header-only, meaning there is no shared library to link against. A few commonly used exceptions to this are the `filesystem`, `regex` and `program_options` libraries, and these will be linked by default. If your package requires linking to additional boost shared libraries these can be added to the LIB_EXTRA variable in the `Rules.mk` file</span>
<a name="l00070"></a>00070  * CMSSW: Files can be included relative to the CMSSW `src` directory, e.g. `#include &quot;PhysicsTools/FWLite/interface/TFileService.h&quot;`. Both the local CMSSW area and the base release will be searched. CMSSW libraries `libFWCoreFWLite` and `libPhysicsToolsFWLite` are linked by default as these are needed to load custom object classes stored in TTrees. The library `libUserCodeICHiggsTauTau` is also linked which contains the class definitions defined in the `Usercode/ICHiggsTauTau` package.
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 Compile without CMSSW {#build-system-no-cmssw}
<a name="l00073"></a>00073 ==============================================
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 \todo Write instructions for CMSSW-less make
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 Generate ROOT dictionaries {#build-system-dict}
<a name="l00078"></a>00078 ===============================================
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 \todo Write instructions for generating ROOT dictionaries
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_build_system_8md.html">BuildSystem.md</a>      </li>
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->



</body>
</html>
