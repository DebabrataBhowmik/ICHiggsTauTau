<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.7.6.1"/>
<title>Imperial Analysis: plugins/ICJetDestHelper.hh</title>

<link href="$relpath^tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="$relpath^jquery.js"></script>
<script type="text/javascript" src="$relpath^dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>

<link href="$relpath^doxygen.css" rel="stylesheet" type="text/css" />
$extrastylesheet
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 70px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Imperial Analysis
   
   </div>
   
  </td>
  
  
  
   
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
   
  
 </tr>
 </tbody>
</table>
</div>

<!-- end header part -->
<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('plugins_2_i_c_jet_dest_helper_8hh-example.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">plugins/ICJetDestHelper.hh</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><span class="preprocessor">#ifndef UserCode_ICHiggsTauTau_ICJetDestHelper_h</span>
<span class="preprocessor"></span><span class="preprocessor">#define UserCode_ICHiggsTauTau_ICJetDestHelper_h</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &lt;memory&gt;</span>
<span class="preprocessor">#include &quot;boost/functional/hash.hpp&quot;</span>
<span class="preprocessor">#include &quot;FWCore/ParameterSet/interface/ParameterSet.h&quot;</span>
<span class="preprocessor">#include &quot;FWCore/Framework/interface/Event.h&quot;</span>
<span class="preprocessor">#include &quot;FWCore/Framework/interface/EventSetup.h&quot;</span>
<span class="preprocessor">#include &quot;FWCore/Framework/interface/EDProducer.h&quot;</span>
<span class="preprocessor">#include &quot;FWCore/Utilities/interface/InputTag.h&quot;</span>
<span class="preprocessor">#include &quot;DataFormats/Math/interface/deltaR.h&quot;</span>
<span class="preprocessor">#include &quot;DataFormats/JetReco/interface/CaloJet.h&quot;</span>
<span class="preprocessor">#include &quot;DataFormats/JetReco/interface/PFJet.h&quot;</span>
<span class="preprocessor">#include &quot;DataFormats/TrackReco/interface/TrackFwd.h&quot;</span>
<span class="preprocessor">#include &quot;UserCode/ICHiggsTauTau/interface/JPTJet.hh&quot;</span>
<span class="preprocessor">#include &quot;UserCode/ICHiggsTauTau/interface/PFJet.hh&quot;</span>
<span class="preprocessor">#include &quot;UserCode/ICHiggsTauTau/interface/CaloJet.hh&quot;</span>
<span class="preprocessor">#include &quot;PhysicsTools/SelectorUtils/interface/JetIDSelectionFunctor.h&quot;</span>
<span class="preprocessor">#include &quot;UserCode/ICHiggsTauTau/plugins/PrintConfigTools.h&quot;</span>

<span class="keyword">template</span> &lt;<span class="keyword">class</span> U&gt;
<span class="keyword">struct </span><a name="_a0"></a><a class="code" href="struct_jet_dest_helper.html">JetDestHelper</a> {
  <span class="keyword">explicit</span> <a name="a1"></a><a class="code" href="struct_jet_dest_helper.html#a5671724de54420c55b4489263ecf887a">JetDestHelper</a>(<span class="keyword">const</span> edm::ParameterSet &amp;pset) {}
  <span class="keywordtype">void</span> <a name="a2"></a><a class="code" href="struct_jet_dest_helper.html#a0c41e9ae22a84115db02466caae6ab2b">DoSetup</a>(edm::EDProducer * prod) {}
  <a name="a3"></a><a class="code" href="struct_jet_dest_helper.html#aa37bbbd024eb088226ff944c506fe856">~JetDestHelper</a>() {}
};

<span class="keyword">template</span> &lt;&gt;
<span class="keyword">struct </span><a class="code" href="struct_jet_dest_helper.html">JetDestHelper</a>&lt;ic::CaloJet&gt; {
  <span class="keywordtype">bool</span> do_jet_id;
  edm::InputTag input_jet_id;
  JetIDSelectionFunctor *loose_id;
  JetIDSelectionFunctor *tight_id;
  <span class="keywordtype">bool</span> do_n_carrying;

  <span class="keyword">explicit</span> <a class="code" href="struct_jet_dest_helper.html#a5671724de54420c55b4489263ecf887a">JetDestHelper</a>(<span class="keyword">const</span> edm::ParameterSet &amp;pset)
      : do_jet_id(pset.getParameter&lt;bool&gt;(<span class="stringliteral">&quot;includeJetID&quot;</span>)),
        input_jet_id(pset.getParameter&lt;edm::InputTag&gt;(<span class="stringliteral">&quot;inputJetID&quot;</span>)),
        loose_id(NULL),
        tight_id(NULL),
        do_n_carrying(pset.getParameter&lt;bool&gt;(<span class="stringliteral">&quot;includeTowerCounts&quot;</span>)) {
    loose_id = <span class="keyword">new</span> JetIDSelectionFunctor(JetIDSelectionFunctor::PURE09,
                                         JetIDSelectionFunctor::LOOSE);
    tight_id = <span class="keyword">new</span> JetIDSelectionFunctor(JetIDSelectionFunctor::PURE09,
                                         JetIDSelectionFunctor::TIGHT);
  }

  <span class="keywordtype">void</span> <a class="code" href="struct_jet_dest_helper.html#a0c41e9ae22a84115db02466caae6ab2b">DoSetup</a>(edm::EDProducer * prod) {
    std::cout &lt;&lt; <span class="stringliteral">&quot;CaloJet specific options:\n&quot;</span>;
    <a name="a4"></a><a class="code" href="_print_config_tools_8cc.html#af3a7490bc1960e5f17ef84108eb73d79">PrintOptional</a>(1, do_jet_id, <span class="stringliteral">&quot;includeJetID&quot;</span>);
    <a class="code" href="_print_config_tools_8cc.html#af3a7490bc1960e5f17ef84108eb73d79">PrintOptional</a>(1, do_n_carrying, <span class="stringliteral">&quot;includeTowerCounts&quot;</span>);
  }

  <a class="code" href="struct_jet_dest_helper.html#aa37bbbd024eb088226ff944c506fe856">~JetDestHelper</a>() {
    <span class="keyword">delete</span> loose_id;
    <span class="keyword">delete</span> tight_id;
  }
};

<span class="keyword">template</span> &lt;&gt;
<span class="keyword">struct </span><a class="code" href="struct_jet_dest_helper.html">JetDestHelper</a>&lt;ic::JPTJet&gt; {
  <span class="keywordtype">bool</span> do_jet_id;
  edm::InputTag input_jet_id;
  JetIDSelectionFunctor *loose_id;
  JetIDSelectionFunctor *tight_id;
  <span class="keywordtype">bool</span> request_trks;
  boost::hash&lt;reco::Track const*&gt; track_hasher;
  <span class="keywordtype">bool</span> do_trk_vars;
  edm::InputTag input_trks;
  edm::InputTag input_vtxs;
  <span class="keywordtype">bool</span> do_n_carrying;

  <span class="keyword">explicit</span> <a class="code" href="struct_jet_dest_helper.html#a5671724de54420c55b4489263ecf887a">JetDestHelper</a>(<span class="keyword">const</span> edm::ParameterSet &amp;pset)
      : do_jet_id(pset.getParameter&lt;bool&gt;(<span class="stringliteral">&quot;includeJetID&quot;</span>)),
        input_jet_id(pset.getParameter&lt;edm::InputTag&gt;(<span class="stringliteral">&quot;inputJetID&quot;</span>)),
        loose_id(NULL),
        tight_id(NULL),
        request_trks(pset.getParameter&lt;bool&gt;(<span class="stringliteral">&quot;requestTracks&quot;</span>)),
        do_trk_vars(pset.getParameter&lt;bool&gt;(<span class="stringliteral">&quot;includeTrackBasedVars&quot;</span>)),
        input_trks(pset.getParameter&lt;edm::InputTag&gt;(<span class="stringliteral">&quot;inputTracks&quot;</span>)),
        input_vtxs(pset.getParameter&lt;edm::InputTag&gt;(<span class="stringliteral">&quot;inputVertices&quot;</span>)),
        do_n_carrying(pset.getParameter&lt;bool&gt;(<span class="stringliteral">&quot;includeTowerCounts&quot;</span>)) {
    loose_id = <span class="keyword">new</span> JetIDSelectionFunctor(JetIDSelectionFunctor::PURE09,
                                         JetIDSelectionFunctor::LOOSE);
    tight_id = <span class="keyword">new</span> JetIDSelectionFunctor(JetIDSelectionFunctor::PURE09,
                                         JetIDSelectionFunctor::TIGHT);
  }

  <span class="keywordtype">void</span> <a class="code" href="struct_jet_dest_helper.html#a0c41e9ae22a84115db02466caae6ab2b">DoSetup</a>(edm::EDProducer * prod) {
    <span class="keywordflow">if</span> (request_trks) {
      prod-&gt;produces&lt;reco::TrackRefVector&gt;(<span class="stringliteral">&quot;requestedTracks&quot;</span>);
    }
    std::cout &lt;&lt; <span class="stringliteral">&quot;JPTJet specific options:\n&quot;</span>;
    <a class="code" href="_print_config_tools_8cc.html#af3a7490bc1960e5f17ef84108eb73d79">PrintOptional</a>(1, do_jet_id, <span class="stringliteral">&quot;includeJetID&quot;</span>);
    <a class="code" href="_print_config_tools_8cc.html#af3a7490bc1960e5f17ef84108eb73d79">PrintOptional</a>(1, do_n_carrying, <span class="stringliteral">&quot;includeTowerCounts&quot;</span>);
    <a class="code" href="_print_config_tools_8cc.html#af3a7490bc1960e5f17ef84108eb73d79">PrintOptional</a>(1, request_trks, <span class="stringliteral">&quot;requestTracks&quot;</span>);
    <a class="code" href="_print_config_tools_8cc.html#af3a7490bc1960e5f17ef84108eb73d79">PrintOptional</a>(1, do_trk_vars, <span class="stringliteral">&quot;includeTrackBasedVars&quot;</span>);
  }

  std::vector&lt;std::size_t&gt; DoTrackCollection(
      reco::TrackRefVector <span class="keyword">const</span> &amp;ref_vec, reco::TrackRefVector *target) {
    std::vector&lt;std::size_t&gt; res(ref_vec.size(), 0);
    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; ref_vec.size(); ++i) {
      res[i] = track_hasher(&amp;(*(ref_vec[i])));
      target-&gt;push_back(ref_vec[i]);
    }
    <span class="keywordflow">return</span> res;
  }

  <span class="keywordtype">void</span> AddTrackCollection(reco::TrackRefVector <span class="keyword">const</span> &amp;ref_vec,
                          std::vector&lt;reco::Track const *&gt; *target) {
    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; ref_vec.size(); ++i) {
      target-&gt;push_back(&amp;(*(ref_vec[i])));
    }
  }

  <a class="code" href="struct_jet_dest_helper.html#aa37bbbd024eb088226ff944c506fe856">~JetDestHelper</a>() {
    <span class="keyword">delete</span> loose_id;
    <span class="keyword">delete</span> tight_id;
  }
};

<span class="keyword">template</span> &lt;&gt;
<span class="keyword">struct </span><a class="code" href="struct_jet_dest_helper.html">JetDestHelper</a>&lt;ic::PFJet&gt; {
  <span class="keywordtype">bool</span> do_pu_id;
  edm::InputTag input_pu_id;
  <span class="keywordtype">bool</span> do_trk_vars;
  edm::InputTag input_trks;
  edm::InputTag input_vtxs;
  <span class="keywordtype">bool</span> request_trks;
  boost::hash&lt;reco::Track const*&gt; track_hasher;

  <span class="keyword">explicit</span> <a class="code" href="struct_jet_dest_helper.html#a5671724de54420c55b4489263ecf887a">JetDestHelper</a>(<span class="keyword">const</span> edm::ParameterSet &amp;pset)
      : do_pu_id(pset.getParameter&lt;bool&gt;(<span class="stringliteral">&quot;includePileupID&quot;</span>)),
        input_pu_id(pset.getParameter&lt;edm::InputTag&gt;(<span class="stringliteral">&quot;inputPileupID&quot;</span>)),
        do_trk_vars(pset.getParameter&lt;bool&gt;(<span class="stringliteral">&quot;includeTrackBasedVars&quot;</span>)),
        input_trks(pset.getParameter&lt;edm::InputTag&gt;(<span class="stringliteral">&quot;inputTracks&quot;</span>)),
        input_vtxs(pset.getParameter&lt;edm::InputTag&gt;(<span class="stringliteral">&quot;inputVertices&quot;</span>)),
        request_trks(pset.getParameter&lt;bool&gt;(<span class="stringliteral">&quot;requestTracks&quot;</span>)) {}

  <span class="keywordtype">void</span> <a class="code" href="struct_jet_dest_helper.html#a0c41e9ae22a84115db02466caae6ab2b">DoSetup</a>(edm::EDProducer * prod) {
    <span class="keywordflow">if</span> (request_trks) {
      prod-&gt;produces&lt;reco::TrackRefVector&gt;(<span class="stringliteral">&quot;requestedTracks&quot;</span>);
    }
    std::cout &lt;&lt; <span class="stringliteral">&quot;PFJet specific options:\n&quot;</span>;
    <a class="code" href="_print_config_tools_8cc.html#af3a7490bc1960e5f17ef84108eb73d79">PrintOptional</a>(1, do_pu_id, <span class="stringliteral">&quot;includePileupID&quot;</span>);
    <a class="code" href="_print_config_tools_8cc.html#af3a7490bc1960e5f17ef84108eb73d79">PrintOptional</a>(1, request_trks, <span class="stringliteral">&quot;requestTracks&quot;</span>);
    <a class="code" href="_print_config_tools_8cc.html#af3a7490bc1960e5f17ef84108eb73d79">PrintOptional</a>(1, do_trk_vars, <span class="stringliteral">&quot;includeTrackBasedVars&quot;</span>);
  }

  <a class="code" href="struct_jet_dest_helper.html#aa37bbbd024eb088226ff944c506fe856">~JetDestHelper</a>() {}
};

<span class="keyword">template</span>&lt;<span class="keyword">class</span> U&gt;
<span class="keywordtype">void</span> <a name="a5"></a><a class="code" href="_i_c_jet_dest_helper_8hh.html#a5afdbe81deb9199c57c770cef34ba3ae">FillCommonPFJet</a>(<a name="_a6"></a><a class="code" href="classic_1_1_p_f_jet.html" title="A class deriving from ic::Jet that provides specific information for particle-flow jets...">ic::PFJet</a> *dest, U <span class="keyword">const</span>&amp; src) {
  dest-&gt;<a name="a7"></a><a class="code" href="classic_1_1_p_f_jet.html#a5b842ff2ed7d5c282a726800c5430825" title="Number of PF muon constituents. ">set_muon_multiplicity</a>(src.muonMultiplicity());
  dest-&gt;<a name="a8"></a><a class="code" href="classic_1_1_p_f_jet.html#aa8d2b1702786168fbd0a02f8b8b12e1c" title="Number of charged constituents. ">set_charged_multiplicity</a>(src.chargedMultiplicity());
  dest-&gt;<a name="a9"></a><a class="code" href="classic_1_1_p_f_jet.html#a940bc75056580570de2f9ff1c1ffba83" title="Number of charged hadron constituents. ">set_charged_had_multiplicity</a>(src.chargedHadronMultiplicity());
  dest-&gt;<a name="a10"></a><a class="code" href="classic_1_1_p_f_jet.html#a329114e422a0f3328035682f07426747" title="Number of neutral hadron constituents. ">set_neutral_had_multiplicity</a>(src.neutralHadronMultiplicity());
  dest-&gt;<a name="a11"></a><a class="code" href="classic_1_1_p_f_jet.html#a5e818372066c19ced43a6c26aa6f6e1c" title="Number of PF photon constituents. ">set_photon_multiplicity</a>(src.photonMultiplicity());
  dest-&gt;<a name="a12"></a><a class="code" href="classic_1_1_p_f_jet.html#a862b55a74085d2ea27adcb41532850a4" title="Number of PF electron constituents. ">set_electron_multiplicity</a>(src.electronMultiplicity());
  dest-&gt;<a name="a13"></a><a class="code" href="classic_1_1_p_f_jet.html#a743d42d0d80f185c604ee7a477fccd02" title="Number PF HF hadronic constituents. ">set_HF_had_multiplicity</a>(src.HFHadronMultiplicity());
  dest-&gt;<a name="a14"></a><a class="code" href="classic_1_1_p_f_jet.html#a7c237a8c93290d6bbdb8f36957bc15bb" title="Number of PF HF electromagnetic constituents. ">set_HF_em_multiplicity</a>(src.HFEMMultiplicity());
  dest-&gt;<a name="a15"></a><a class="code" href="classic_1_1_p_f_jet.html#a68ab5c9248b3b1f1bc20b15520b79e17" title="Number of neutral constituents. ">set_neutral_multiplicity</a>(src.neutralMultiplicity());
  dest-&gt;<a name="a16"></a><a class="code" href="classic_1_1_p_f_jet.html#afc5148c5bcad67981e8b96c4ce10e2da" title="Charged electromagnetic energy. ">set_charged_em_energy</a>(src.chargedEmEnergy());
  dest-&gt;<a name="a17"></a><a class="code" href="classic_1_1_p_f_jet.html#a32ea9ffaf84f40c75fd36a5f3f16d7ad" title="Neutral electromagnetic energy. ">set_neutral_em_energy</a>(src.neutralEmEnergy());
  dest-&gt;<a name="a18"></a><a class="code" href="classic_1_1_p_f_jet.html#a49c2085faae796587b377ea7467c9bda" title="Charged hadron energy. ">set_charged_had_energy</a>(src.chargedHadronEnergy());
  dest-&gt;<a name="a19"></a><a class="code" href="classic_1_1_p_f_jet.html#ae76d56cf58065d52b731f4c006f78990" title="Neutral hadron energy. ">set_neutral_had_energy</a>(src.neutralHadronEnergy());
  dest-&gt;<a name="a20"></a><a class="code" href="classic_1_1_p_f_jet.html#ac12be85aeb197251e4a9825ebcc51ed6" title="Photon energy. ">set_photon_energy</a>(src.photonEnergy());
  dest-&gt;<a name="a21"></a><a class="code" href="classic_1_1_p_f_jet.html#a3e2efd255a30c097c2a6ce764386a12c" title="Electron energy. ">set_electron_energy</a>(src.electronEnergy());
  dest-&gt;<a name="a22"></a><a class="code" href="classic_1_1_p_f_jet.html#a17132f732ca1ee85cced5ee9a559a9da" title="Muon energy. ">set_muon_energy</a>(src.muonEnergy());
  dest-&gt;<a name="a23"></a><a class="code" href="classic_1_1_p_f_jet.html#af1fa4ac55a90dec005062667601a243e" title="HF hadronic energy. ">set_HF_had_energy</a>(src.HFHadronEnergy());
  dest-&gt;<a name="a24"></a><a class="code" href="classic_1_1_p_f_jet.html#ae2d79870e4307d827bbbc472b764586e" title="HF electromagnetic energy. ">set_HF_em_energy</a>(src.HFEMEnergy());
  dest-&gt;<a name="a25"></a><a class="code" href="classic_1_1_p_f_jet.html#aa9d46ac19e753800d36cd155a44d4052" title="Muon energy. ">set_charged_mu_energy</a>(src.chargedMuEnergy());
}

<span class="keyword">template</span>&lt;<span class="keyword">class</span> U&gt;
<span class="keywordtype">void</span> <a name="a26"></a><a class="code" href="_i_c_jet_dest_helper_8hh.html#ae09776fe0ad6e64ad0105611a8057036">FillCommonCaloJet</a>(<a name="_a27"></a><a class="code" href="classic_1_1_calo_jet.html" title="Derived from the ic::Jet class and adding information specific to calorimeter jets.">ic::CaloJet</a> *dest, U <span class="keyword">const</span>&amp; src) {
  dest-&gt;<a name="a28"></a><a class="code" href="classic_1_1_calo_jet.html#ade0f3ee80cd9f9b58a6cb0733c89a086" title="Maximum energy deposited in the ECAL towers. ">set_max_em_tower_energy</a>(src.maxEInEmTowers());
  dest-&gt;<a name="a29"></a><a class="code" href="classic_1_1_calo_jet.html#aefd28204bd54b958da89ff21a2367846" title="Maximum energy deposited in the HCAL towers. ">set_max_had_tower_energy</a>(src.maxEInHadTowers());
  dest-&gt;<a name="a30"></a><a class="code" href="classic_1_1_calo_jet.html#a81497e173da43492b2e98279e93dc425" title="Hadronic fraction of the jet energy. ">set_energy_frac_had</a>(src.energyFractionHadronic());
  dest-&gt;<a name="a31"></a><a class="code" href="classic_1_1_calo_jet.html#affc80bf529e2e3743b565c7c42ad1f8c" title="Electromagnetic fraction of the jet energy. ">set_energy_frac_em</a>(src.emEnergyFraction());
  dest-&gt;<a name="a32"></a><a class="code" href="classic_1_1_calo_jet.html#aad46aaa76fb71a6f028cc496c7c0b8eb" title="Hadronic energy in the HB detector. ">set_had_energy_HB</a>(src.hadEnergyInHB());
  dest-&gt;<a name="a33"></a><a class="code" href="classic_1_1_calo_jet.html#a273da937db199304a4babc54a6dbdd81" title="Hadronic energy in the HO detector. ">set_had_energy_HO</a>(src.hadEnergyInHO());
  dest-&gt;<a name="a34"></a><a class="code" href="classic_1_1_calo_jet.html#a5e149c262834dc9b9d41efe94a9636b3" title="Hadronic energy in the HE detector. ">set_had_energy_HE</a>(src.hadEnergyInHE());
  dest-&gt;<a name="a35"></a><a class="code" href="classic_1_1_calo_jet.html#a748ed9b925a9b54d253e9a06b44dbeed" title="Hadronic energy in the HF detector. ">set_had_energy_HF</a>(src.hadEnergyInHF());
  dest-&gt;<a name="a36"></a><a class="code" href="classic_1_1_calo_jet.html#ae6a0970b81830ed25271511bdc6474de" title="Electromagnetic energy in the EB detector. ">set_em_energy_EB</a>(src.emEnergyInEB());
  dest-&gt;<a name="a37"></a><a class="code" href="classic_1_1_calo_jet.html#a63a0659b5cfe388ba227155cbf2757f5" title="Electromagnetic energy in the EE detector. ">set_em_energy_EE</a>(src.emEnergyInEE());
  dest-&gt;<a name="a38"></a><a class="code" href="classic_1_1_calo_jet.html#a8841894af76be0d65e7842e720e7524b" title="Electromagnetic energy in the HF detector. ">set_em_energy_HF</a>(src.emEnergyInHF());
  dest-&gt;<a name="a39"></a><a class="code" href="classic_1_1_calo_jet.html#a1ad8ca266222088787e6d9a32252fa49" title="Area of towers contributing to the jet. ">set_towers_area</a>(src.towersArea());
}

<span class="keyword">template</span>&lt;<span class="keyword">class</span> U&gt;
<span class="keywordtype">void</span> <a name="a40"></a><a class="code" href="_i_c_jet_dest_helper_8hh.html#a8cac3c1accfb2c2a1fbac43e40986043">FillCommonJPTJet</a>(<a name="_a41"></a><a class="code" href="classic_1_1_j_p_t_jet.html" title="A class derived from ic::Jet which adds Jet-plus-track specific information.">ic::JPTJet</a> *dest, U <span class="keyword">const</span>&amp; src) {
  dest-&gt;<a name="a42"></a><a class="code" href="classic_1_1_j_p_t_jet.html#ac2bdab84456712ba893b212416b7a3be" title="Number of muon constituents. ">set_muon_multiplicity</a>(src.muonMultiplicity());
  dest-&gt;<a name="a43"></a><a class="code" href="classic_1_1_j_p_t_jet.html#ab5b65ce32cfebaaeae31dc0071194548" title="Total number of charged constituents. ">set_charged_multiplicity</a>(src.chargedMultiplicity());
  dest-&gt;<a name="a44"></a><a class="code" href="classic_1_1_j_p_t_jet.html#ae1313ef640917e148a6de4730b51549d" title="Charged EM energy. ">set_charged_em_energy</a>(src.chargedEmEnergy());
  dest-&gt;<a name="a45"></a><a class="code" href="classic_1_1_j_p_t_jet.html#ae68d2dfb7e246d1bfb078c707f2a7d44" title="Neutral EM energy. ">set_neutral_em_energy</a>(src.neutralEmEnergy());
  dest-&gt;<a name="a46"></a><a class="code" href="classic_1_1_j_p_t_jet.html#a6ebfdcad306361d08d1cee95ec0fa625" title="Charged hadron energy. ">set_charged_had_energy</a>(src.chargedHadronEnergy());
  dest-&gt;<a name="a47"></a><a class="code" href="classic_1_1_j_p_t_jet.html#a8e8ed3811b39e3629354588ed3474aa5" title="Neutral hadron energy. ">set_neutral_had_energy</a>(src.neutralHadronEnergy());
}


std::map&lt;unsigned, unsigned&gt; <a name="a48"></a><a class="code" href="_i_c_jet_dest_helper_8hh.html#acca43eada309143017b94c219d14cee8">BuildTrkVtxMap</a>(
    edm::Handle&lt;reco::TrackCollection&gt; <span class="keyword">const</span> &amp;trk_handle,
    edm::Handle&lt;reco::VertexCollection&gt; <span class="keyword">const</span> &amp;vtx_handle) {
  std::map&lt;unsigned, unsigned&gt; trk_vtx_map;
  <span class="keywordflow">if</span> (trk_handle-&gt;size() &gt; 0) {
    reco::Track <span class="keyword">const</span> *ptr_to_first = &amp;(trk_handle-&gt;at(0));
    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; vtx_handle-&gt;size(); ++i) {
      std::vector&lt;reco::TrackBaseRef&gt;::const_iterator trk_it;
      <span class="keywordflow">for</span> (trk_it = vtx_handle-&gt;at(i).tracks_begin();
           trk_it != vtx_handle-&gt;at(i).tracks_end(); ++trk_it) {
        reco::Track <span class="keyword">const</span> *ptr_to_trk =
            <span class="keyword">dynamic_cast&lt;</span>reco::Track <span class="keyword">const </span>*<span class="keyword">&gt;</span>(&amp;(**trk_it));
        <span class="keywordtype">unsigned</span> trk_idx = (unsigned(ptr_to_trk - ptr_to_first));
        trk_vtx_map[trk_idx] = i;
      }
    }
  }
  <span class="keywordflow">return</span> trk_vtx_map;
}

<span class="keywordtype">void</span> <a name="a49"></a><a class="code" href="_i_c_jet_dest_helper_8hh.html#a980e8e55f381968aacecc4a75a1d9aa4">FillPFTracksAndRequest</a>(<a class="code" href="classic_1_1_p_f_jet.html" title="A class deriving from ic::Jet that provides specific information for particle-flow jets...">ic::PFJet</a> *dest,
                            std::vector&lt;reco::PFCandidatePtr&gt; <span class="keyword">const</span> &amp;pfcands,
                            reco::TrackRefVector *track_requests,
                            boost::hash&lt;reco::Track const *&gt; *track_hasher) {
  std::vector&lt;std::size_t&gt; track_ids;
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> iP = 0; iP &lt; pfcands.size(); ++iP) {
    <span class="keywordflow">if</span> (pfcands[iP]-&gt;trackRef().isNonnull()) {
      track_requests-&gt;push_back(pfcands[iP]-&gt;trackRef());
      track_ids.push_back((*track_hasher)(&amp;(*(pfcands[iP]-&gt;trackRef()))));
    }
  }
  dest-&gt;<a name="a50"></a><a class="code" href="classic_1_1_p_f_jet.html#aed86a96cae5e558a20a73ee9ebe3585f" title="A vector to refer to the constituent track ic::Track::id() values. ">set_constituent_tracks</a>(track_ids);
}

<span class="keywordtype">void</span> <a name="a51"></a><a class="code" href="_i_c_jet_dest_helper_8hh.html#a02c2e07b8cf921aecb5a5dd67270ef2b">FillJPTTrackVars</a>(<a class="code" href="classic_1_1_j_p_t_jet.html" title="A class derived from ic::Jet which adds Jet-plus-track specific information.">ic::JPTJet</a> *dest,
                      std::vector&lt;reco::Track const *&gt; <span class="keyword">const</span> &amp;all_tracks,
                      edm::Handle&lt;reco::TrackCollection&gt; <span class="keyword">const</span> &amp;trk_handle,
                      edm::Handle&lt;reco::VertexCollection&gt; <span class="keyword">const</span> &amp;vtx_handle,
                      std::map&lt;unsigned, unsigned&gt; <span class="keyword">const</span> &amp;trk_vtx_map) {
  std::vector&lt;double&gt; pt_at_vtx_vec(vtx_handle-&gt;size(), 0.0);
  reco::Track <span class="keyword">const</span> *ptr_first = &amp;(trk_handle-&gt;at(0));
  <span class="keywordtype">double</span> trk_pt_total = 0.0;
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; all_tracks.size(); ++j) {
    <span class="keywordtype">unsigned</span> idx = unsigned(all_tracks[j] - ptr_first);
    trk_pt_total += all_tracks[j]-&gt;pt();
    <span class="comment">// Is track associated to a vertex?</span>
    <span class="keywordflow">if</span> (trk_vtx_map.count(idx) &gt; 0) {
      pt_at_vtx_vec[trk_vtx_map.find(idx)-&gt;second] += all_tracks[j]-&gt;pt();
    } <span class="keywordflow">else</span> {  <span class="comment">// No, so is it within 0.2 cm wrt the closest vertex in z</span>
      std::vector&lt;double&gt; dz_with_vtx(vtx_handle-&gt;size(), 0.0);
      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 0; k &lt; vtx_handle-&gt;size(); ++k) {
        dz_with_vtx[k] = fabs(vtx_handle-&gt;at(k).z() - all_tracks[j]-&gt;vz());
      }
      std::vector&lt;double&gt;::const_iterator min =
          std::min_element(dz_with_vtx.begin(), dz_with_vtx.end());
      <span class="keywordflow">if</span> (min != dz_with_vtx.end()) {
        <span class="keywordflow">if</span> (*min &lt; 0.2) {
          pt_at_vtx_vec[unsigned(min - dz_with_vtx.begin())] +=
              all_tracks[j]-&gt;pt();
        }
      }
    }
  }
  <span class="keywordflow">if</span> (vtx_handle-&gt;size() &gt; 0 &amp;&amp; trk_pt_total &gt; 0.0) {
    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; pt_at_vtx_vec.size(); ++j) {
      pt_at_vtx_vec[j] = pt_at_vtx_vec[j] / trk_pt_total;
    }
    dest-&gt;<a name="a52"></a><a class="code" href="classic_1_1_j_p_t_jet.html#aff8a34ceb2ecb642d82cbc07f499cc97" title="The fraction of the constituent track momentum associated to the primary vertex. ">set_beta</a>(pt_at_vtx_vec[0]);
    dest-&gt;<a name="a53"></a><a class="code" href="classic_1_1_j_p_t_jet.html#ae202b25af401e02681c40dc892c611b7" title="The largest value of beta() obtained when it is evaluated for every vertex in the event...">set_beta_max</a>(
        *std::max_element(pt_at_vtx_vec.begin(), pt_at_vtx_vec.end()));
    dest-&gt;<a name="a54"></a><a class="code" href="classic_1_1_j_p_t_jet.html#ab2629aed141b1ccdd921cda75fb4b7ab" title="The scalar sum of track . ">set_track_pt_total</a>(trk_pt_total);
  } <span class="keywordflow">else</span> {
    dest-&gt;<a class="code" href="classic_1_1_j_p_t_jet.html#aff8a34ceb2ecb642d82cbc07f499cc97" title="The fraction of the constituent track momentum associated to the primary vertex. ">set_beta</a>(-1.);
    dest-&gt;<a class="code" href="classic_1_1_j_p_t_jet.html#ae202b25af401e02681c40dc892c611b7" title="The largest value of beta() obtained when it is evaluated for every vertex in the event...">set_beta_max</a>(-1.);
    dest-&gt;<a class="code" href="classic_1_1_j_p_t_jet.html#ab2629aed141b1ccdd921cda75fb4b7ab" title="The scalar sum of track . ">set_track_pt_total</a>(0);
  }
}

<span class="keywordtype">void</span> <a name="a55"></a><a class="code" href="_i_c_jet_dest_helper_8hh.html#aef85ed523f50d9c15f6b9646260fb3d8">FillPFTrackVars</a>(<a class="code" href="classic_1_1_p_f_jet.html" title="A class deriving from ic::Jet that provides specific information for particle-flow jets...">ic::PFJet</a> *dest,
                     std::vector&lt;reco::PFCandidatePtr&gt; <span class="keyword">const</span> &amp;pfcands,
                     edm::Handle&lt;reco::TrackCollection&gt; <span class="keyword">const</span> &amp;trk_handle,
                     edm::Handle&lt;reco::VertexCollection&gt; <span class="keyword">const</span> &amp;vtx_handle,
                     std::map&lt;unsigned, unsigned&gt; <span class="keyword">const</span> &amp;trk_vtx_map) {
  <span class="keywordtype">int</span> charged_multiplicity_nopu = 0;
  <span class="keywordtype">float</span> linear_radial_moment_nopu = 0.0;
  <span class="keywordtype">double</span> trk_pt_total = 0.0;
  std::vector&lt;double&gt; pt_at_vtx_vec(vtx_handle-&gt;size(), 0.0);
  reco::Track <span class="keyword">const</span>* ptr_first = &amp;(trk_handle-&gt;at(0));
  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> iP = 0; iP &lt; pfcands.size(); ++iP) {
    <span class="keywordflow">if</span> (pfcands[iP]-&gt;trackRef().isNonnull()) {
      <span class="keywordtype">unsigned</span> idx = unsigned(&amp;(*(pfcands[iP]-&gt;trackRef())) - ptr_first);
      trk_pt_total += pfcands[iP]-&gt;trackRef()-&gt;pt();
      <span class="comment">// Is track associated to a vertex?</span>
      <span class="keywordflow">if</span> (trk_vtx_map.count(idx) &gt; 0) {
        <span class="comment">// If this track is mapped to the first PV, increase number of nopu</span>
        <span class="comment">// charged multiplicity</span>
        <span class="keywordflow">if</span> (trk_vtx_map.find(idx)-&gt;second == 0) {
          ++charged_multiplicity_nopu;
          linear_radial_moment_nopu +=
              pfcands[iP]-&gt;pt() * deltaR(dest-&gt;<a name="a56"></a><a class="code" href="classic_1_1_candidate.html#a416c4cf0462ad4cbe8f2e053c72e1ed0" title="Four-momentum.">vector</a>().Rapidity(), dest-&gt;<a name="a57"></a><a class="code" href="classic_1_1_candidate.html#adce1695da4079ce9c19d00d2bf933cd8" title="Direct access to .">phi</a>(),
                                         pfcands[iP]-&gt;rapidity(),
                                         pfcands[iP]-&gt;phi());
        }
        pt_at_vtx_vec[trk_vtx_map.find(idx)-&gt;second] +=
            pfcands[iP]-&gt;trackRef()-&gt;pt();
      } <span class="keywordflow">else</span> {  <span class="comment">// No, so is it within 0.2 cm wrt the closest vertex in z</span>
        std::vector&lt;double&gt; dz_with_vtx(vtx_handle-&gt;size(), 0.0);
        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> iV = 0; iV &lt; vtx_handle-&gt;size(); ++iV) {
          dz_with_vtx[iV] =
              fabs(vtx_handle-&gt;at(iV).z() - pfcands[iP]-&gt;trackRef()-&gt;vz());
        }
        std::vector&lt;double&gt;::const_iterator min =
            std::min_element(dz_with_vtx.begin(), dz_with_vtx.end());
        <span class="keywordflow">if</span> (min != dz_with_vtx.end()) {
          <span class="keywordflow">if</span> (*min &lt; 0.2) {
            <span class="comment">// As above, if this track is not associated to any vertex, but</span>
            <span class="comment">// is within 0.2 cm of first PV, then increase multiplicity</span>
            <span class="comment">// count</span>
            <span class="keywordflow">if</span> (<span class="keywordtype">unsigned</span>(min-dz_with_vtx.begin()) == 0) {
              ++charged_multiplicity_nopu;
              linear_radial_moment_nopu +=
                  pfcands[iP]-&gt;pt() * deltaR(dest-&gt;<a class="code" href="classic_1_1_candidate.html#a416c4cf0462ad4cbe8f2e053c72e1ed0" title="Four-momentum.">vector</a>().Rapidity(), dest-&gt;<a class="code" href="classic_1_1_candidate.html#adce1695da4079ce9c19d00d2bf933cd8" title="Direct access to .">phi</a>(),
                                             pfcands[iP]-&gt;rapidity(),
                                             pfcands[iP]-&gt;phi());
            }
            pt_at_vtx_vec[unsigned(min - dz_with_vtx.begin())] +=
                pfcands[iP]-&gt;trackRef()-&gt;pt();
          }
        }
      }
    } <span class="keywordflow">else</span> {  <span class="comment">// No track found, assume PF candidate is not PU</span>
      linear_radial_moment_nopu +=
          pfcands[iP]-&gt;pt() * deltaR(dest-&gt;<a class="code" href="classic_1_1_candidate.html#a416c4cf0462ad4cbe8f2e053c72e1ed0" title="Four-momentum.">vector</a>().Rapidity(), dest-&gt;<a class="code" href="classic_1_1_candidate.html#adce1695da4079ce9c19d00d2bf933cd8" title="Direct access to .">phi</a>(),
                                     pfcands[iP]-&gt;rapidity(),
                                     pfcands[iP]-&gt;phi());
    }
  }
  <span class="comment">// IMPORTANT: taking the dest pt() here not the src()!</span>
  linear_radial_moment_nopu = linear_radial_moment_nopu / dest-&gt;<a name="a58"></a><a class="code" href="classic_1_1_candidate.html#a335fc63932fe160ac00bf416befa4e2d" title="Direct access to the .">pt</a>();
  dest-&gt;<a name="a59"></a><a class="code" href="classic_1_1_p_f_jet.html#acf8fa3f9043d2ba82ffe0073eee16175" title="Used for quark-gluon discrimination. ">set_linear_radial_moment</a>(linear_radial_moment_nopu);
  dest-&gt;<a name="a60"></a><a class="code" href="classic_1_1_p_f_jet.html#ac90849de96cf0a33aa5b233f46f7d487" title="The number of charged constituents associated to the PV. ">set_charged_multiplicity_nopu</a>(charged_multiplicity_nopu);
  <span class="comment">// jet.set_constituent_tracks(trks);</span>
  <span class="keywordflow">if</span> (vtx_handle-&gt;size() &gt; 0 &amp;&amp; trk_pt_total &gt; 0.0) {
    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> iV = 0; iV &lt; pt_at_vtx_vec.size(); ++iV) {
      pt_at_vtx_vec[iV] = pt_at_vtx_vec[iV] / trk_pt_total;
    }
    dest-&gt;<a name="a61"></a><a class="code" href="classic_1_1_p_f_jet.html#a8afeb0b04bdfddf782862f398b63ef87" title="The fraction of the constituent track momentum associated to the primary vertex. ">set_beta</a>(pt_at_vtx_vec[0]);
    dest-&gt;<a name="a62"></a><a class="code" href="classic_1_1_p_f_jet.html#a14c4bae734cf143ec033af4423ad0092" title="The largest value of beta() obtained when it is evaluated for every vertex in the event...">set_beta_max</a>(
        *std::max_element(pt_at_vtx_vec.begin(), pt_at_vtx_vec.end()));
  } <span class="keywordflow">else</span> {
    dest-&gt;<a class="code" href="classic_1_1_p_f_jet.html#a8afeb0b04bdfddf782862f398b63ef87" title="The fraction of the constituent track momentum associated to the primary vertex. ">set_beta</a>(-1.0);
    dest-&gt;<a class="code" href="classic_1_1_p_f_jet.html#a14c4bae734cf143ec033af4423ad0092" title="The largest value of beta() obtained when it is evaluated for every vertex in the event...">set_beta_max</a>(-1.0);
  }
}

<span class="preprocessor">#endif</span>
</pre></div> </div><!-- contents -->
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
  <div id="nav-path" class="navpath">
    <ul>
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->



</body>
</html>
